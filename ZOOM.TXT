// ==UserScript==
// @name        Voxiom.io Hybrid Zoom (Z-Toggle, F-Hold) v√µ gia an
// @namespace   Violentmonkey Scripts
// @match       https://voxiom.io/*
// @grant       none
// @version     5.0
// @author      B·∫°n
// @description Z: B·∫≠t/T·∫Øt | F: ƒê√®/Th·∫£ | Menu tr·∫Øng ƒë·∫πp.
// ==/UserScript==

(function() {
    'use strict';

    // --- 1. C·∫•u h√¨nh & Tr·∫°ng th√°i ---
    const espConfig = {
        zoomLevel: 20,       // ƒê·ªô ph√≥ng ƒë·∫°i (FOV)
        zActive: false,      // Tr·∫°ng th√°i c·ªßa ph√≠m Z (Toggle)
        fActive: false,      // Tr·∫°ng th√°i c·ªßa ph√≠m F (Hold)
        useFKey: true,       // C√≥ cho ph√©p d√πng ph√≠m F kh√¥ng
        zoomKey: 'z',
    };

    // H√†m ki·ªÉm tra xem hi·ªán t·∫°i c√≥ ƒëang Zoom hay kh√¥ng (Do Z ho·∫∑c F k√≠ch ho·∫°t)
    function isZooming() {
        return espConfig.zActive || espConfig.fActive;
    }

    // --- 2. T·∫°o Giao di·ªán (Custom UI White) ---
    const uiContainer = document.createElement('div');
    uiContainer.id = 'vx-zoom-menu';
    uiContainer.innerHTML = `
        <div class="vx-header">
            <h3>üî≠ PRO ZOOM</h3>
            <span class="vx-status" id="vx-status-badge">OFF</span>
        </div>

        <div class="vx-row">
            <label>ƒê·ªô Zoom (FOV): <b id="vx-val-display">20</b></label>
            <input type="range" id="vx-slider" min="1" max="175" value="20">
        </div>

        <div class="vx-row row-check">
            <label for="vx-check-f">B·∫≠t ch·ª©c nƒÉng ƒë√® ph√≠m F</label>
            <input type="checkbox" id="vx-check-f" checked>
        </div>

        <div class="vx-footer">
            [ Z ] : B·∫•m 1 l·∫ßn ƒë·ªÉ B·∫≠t/T·∫Øt<br>
            [ F ] : ƒê√® ƒë·ªÉ Zoom, Th·∫£ ƒë·ªÉ T·∫Øt<br>
            [ . ] : ·∫®n Menu<br>
            V√ï GIA AN V1.0
        </div>
    `;
    document.body.appendChild(uiContainer);

    // --- 3. CSS (Giao di·ªán ƒë·∫πp) ---
    const style = document.createElement('style');
    style.innerHTML = `
        /* Khung Menu */
        #vx-zoom-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 250px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            font-family: 'Segoe UI', sans-serif;
            z-index: 99999;
            padding: 15px;
            border: 1px solid #ddd;
            display: block;
        }

        /* Header */
        .vx-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        .vx-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        /* Badge ON/OFF */
        .vx-status {
            font-size: 11px;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 12px;
            background: #eee;
            color: #777;
            min-width: 35px;
            text-align: center;
            transition: all 0.2s;
        }
        .vx-status.active {
            background: #28a745; /* M√†u xanh l√° */
            color: white;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4);
        }

        /* Inputs */
        .vx-row { margin-bottom: 12px; }
        .vx-row label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }
        .vx-row b { color: #007bff; }

        /* Slider Custom */
        input[type=range] {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 5px;
            -webkit-appearance: none;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }

        /* Footer */
        .vx-footer {
            font-size: 11px;
            color: #999;
            text-align: center;
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 8px;
            line-height: 1.5;
        }
        .row-check { display: flex; justify-content: space-between; align-items: center; }
        .row-check input { width: 16px; height: 16px; cursor: pointer; }
    `;
    document.head.appendChild(style);

    // --- 4. Logic UI ---
    const sliderEl = document.getElementById('vx-slider');
    const displayValEl = document.getElementById('vx-val-display');
    const checkFEl = document.getElementById('vx-check-f');
    const statusBadge = document.getElementById('vx-status-badge');

    // C·∫≠p nh·∫≠t gi√° tr·ªã khi k√©o
    sliderEl.addEventListener('input', (e) => {
        espConfig.zoomLevel = parseInt(e.target.value);
        displayValEl.innerText = espConfig.zoomLevel;
    });

    // C·∫≠p nh·∫≠t checkbox d√πng ph√≠m F
    checkFEl.addEventListener('change', (e) => {
        espConfig.useFKey = e.target.checked;
    });

    // H√†m c·∫≠p nh·∫≠t Badge ON/OFF
    function updateBadge() {
        if (isZooming()) {
            statusBadge.innerText = "ON";
            statusBadge.classList.add('active');
        } else {
            statusBadge.innerText = "OFF";
            statusBadge.classList.remove('active');
        }
    }

    // --- 5. Logic Game (Quan tr·ªçng) ---

    // X·ª≠ l√Ω s·ª± ki·ªán NH·∫§N PH√çM (KeyDown)
    window.addEventListener('keydown', (e) => {
        // Ph√≠m ·∫©n/hi·ªán menu [.]
        if (e.key === '.') {
            if (uiContainer.style.display === 'none') {
                uiContainer.style.display = 'block';
            } else {
                uiContainer.style.display = 'none';
            }
            return;
        }

        // Kh√¥ng ch·∫°y khi ƒëang chat
        if (document.activeElement.tagName === 'INPUT') return;

        const keyL = e.key.toLowerCase();

        // 1. Ph√≠m Z (Toggle): B·∫•m ƒë·ªÉ ƒë·∫£o ng∆∞·ª£c tr·∫°ng th√°i
        if (keyL === espConfig.zoomKey) {
            espConfig.zActive = !espConfig.zActive;
            updateBadge();
        }

        // 2. Ph√≠m F (Hold): B·∫•m gi·ªØ ƒë·ªÉ b·∫≠t
        if (keyL === 'f' && espConfig.useFKey) {
            espConfig.fActive = true;
            updateBadge();
        }
    });

    // X·ª≠ l√Ω s·ª± ki·ªán TH·∫¢ PH√çM (KeyUp)
    window.addEventListener('keyup', (e) => {
        const keyL = e.key.toLowerCase();

        // Ph√≠m F (Hold): Th·∫£ ra ƒë·ªÉ t·∫Øt
        // L∆∞u √Ω: Ph√≠m Z kh√¥ng c·∫ßn x·ª≠ l√Ω ·ªü ƒë√¢y v√¨ n√≥ l√† Toggle
        if (keyL === 'f' && espConfig.useFKey) {
            espConfig.fActive = false;
            updateBadge();
        }
    });

    // X·ª≠ l√Ω cu·ªôn chu·ªôt khi ƒëang Zoom
    window.addEventListener('wheel', (e) => {
        if (isZooming()) {
            e.preventDefault(); // Ch·∫∑n ƒë·ªïi s√∫ng
            if (e.deltaY < 0) {
                espConfig.zoomLevel = Math.max(1, espConfig.zoomLevel - 3);
            } else {
                espConfig.zoomLevel = Math.min(175, espConfig.zoomLevel + 3);
            }
            // ƒê·ªìng b·ªô UI
            sliderEl.value = espConfig.zoomLevel;
            displayValEl.innerText = espConfig.zoomLevel;
        }
    }, { passive: false });

    // Can thi·ªáp Camera (Ch·ªët h·∫°)
    Object.defineProperty(Object.prototype, 'fov', {
        get: function() {
            // Ki·ªÉm tra: N·∫øu Z ƒëang b·∫≠t HO·∫∂C F ƒëang gi·ªØ
            if (this.isPerspectiveCamera && isZooming()) {
                return espConfig.zoomLevel;
            }
            return this._fov;
        },
        set: function(v) {
            this._fov = v;
        },
        configurable: true
    });

    console.log("Voxiom Hybrid Zoom Loaded (Z-Toggle, F-Hold).");

})();